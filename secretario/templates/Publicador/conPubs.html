{% extends "layout.html" %}

{% block contenido %}

<div class="col-xs-12">
	<div class="form-panel">
		<h1 class="text-center titlecolor visible-md visible-lg"><i class="fa fa-angle-right"></i>Publicadores de "El Palito"</h1>
		<h3 class="text-center titlecolor visible-xs visible-sm"><i class="fa fa-angle-right"></i>Publicadores de "El Palito"</h3>

		<div class="form-group">
			{% csrf_token %}
			<div class="row">
				<div class="col-md-12 col-lg-3 panelConPubs">
					<div class="visible-lg">
						<input type="search" class="form-control filtro" placeholder="Ingrese su Busqueda..." />

						<div class="optionGroup">
							<label class="radio-inline">
								<input type="radio" id="opt1" name="iCheck"> Nombre
							</label>
							<label class="radio-inline">
								<input type="radio" id="opt2" name="iCheck"> Edad
							</label>
							<label class="radio-inline">
								<input type="radio" id="opt3" name="iCheck"> Fecha
							</label>
							<label class="radio-inline">
								<input type="radio" id="opt4" name="iCheck"> Grupo
							</label>
						</div>

						<div id="busBau" class="btn-group btnsPubs" role="group">
							<button class="btn btn-default">No Bautizados</button>
							<button class="btn btn-default">Bautizados</button>
							<button id="mayor1" class="btn btn-default">Mayor de 1 año</button>
						</div>

						<div id="mayor2" class="btn-group hide" role="group">
							<button class="btn btn-default">Mas de 1 año</button>
						</div>

						<div class="clearfix"></div>

						<div class="btn-group btnsPubs" role="group">
							<button class="btn btn-default">Menores de 18</button>
							<button class="btn btn-default">Mayores de 18</button>
						</div>

						<div class="clearfix"></div>

						<span class="" style="color:darkcyan;font-size:14px;">Buscar por Estado:</span>
						<div class="btn-group btnsPubs" role="group">
							<button class="btn" style="background-color:#09B20F;width:40px;height:20px;"></button>
							<button class="btn" style="background-color:#ffad33;width:40px;height:20px;"></button>
							<button class="btn" style="background-color:#b30000;width:40px;height:20px;"></button>
							<button class="btn" style="background-color:#009999;width:40px;height:20px;"></button>
							<button class="btn" style="background-color:#b6b6b6;width:40px;height:20px;"></button>
						</div>

						<div class="clearfix"></div>

						<div class="blockPicker">
							<div class="form-group materialPicker">
								<div class="pickerPubs"></div>
							</div>
						</div>

						<button id="clear" class="btn btn-success">Limpiar</button>
					</div>

					<div class="visible-md">
						<div class="row">
							<div id="panelConPubsMD" class="col-md-6">
								<input type="search" class="form-control filtro" placeholder="Ingrese su Busqueda..." />

								<div class="optionGroup">
									<label class="radio-inline">
										<input type="radio" id="opt1" name="iCheck"> Nombre
									</label>
									<label class="radio-inline">
										<input type="radio" id="opt2" name="iCheck"> Edad
									</label>
									<label class="radio-inline">
										<input type="radio" id="opt3" name="iCheck"> Fecha
									</label>
									<label class="radio-inline">
										<input type="radio" id="opt4" name="iCheck"> Grupo
									</label>
								</div>

								<div class="btn-group btnsPubs" role="group">
									<button class="btn btn-default">No Bautizados</button>
									<button class="btn btn-default">Bautizados</button>
									<button class="btn btn-default">Mas de 1 año</button>
								</div>

								<div class="clearfix"></div>

								<div class="btn-group btnsPubs" role="group">
									<button class="btn btn-default">Menores de 18</button>
									<button class="btn btn-default">Mayores de 18</button>
								</div>

								<div class="clearfix"></div>

								<span class="" style="color:darkcyan;font-size:14px;">Buscar por Estado:</span>
								<div class="btn-group btnsPubs" role="group">
									<button class="btn" style="background-color:#09B20F;width:40px;height:20px;"></button>
									<button class="btn" style="background-color:#ffad33;width:40px;height:20px;"></button>
									<button class="btn" style="background-color:#b30000;width:40px;height:20px;"></button>
									<button class="btn" style="background-color:#009999;width:40px;height:20px;"></button>
									<button class="btn" style="background-color:#b6b6b6;width:40px;height:20px;"></button>
								</div>

								<div class="clearfix"></div>

								<button id="clear" class="btn btn-success">Limpiar</button>
							</div>

							<div class="col-md-6">
								<div class="blockPicker">
									<div class="form-group materialPicker">
										<div class="pickerPubs"></div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="visible-sm">

						<input type="search" class="form-control filtro" placeholder="Ingrese su Busqueda..." />

						<div class="clearfix"></div>

						<div class="row">
							<div class="col-sm-6">
								<div class="optionGroup">
									<label class="radio-inline">
										<input type="radio" id="opt1" name="iCheck"> Nombre
									</label>
									<label class="radio-inline">
										<input type="radio" id="opt2" name="iCheck"> Edad
									</label>
									<label class="radio-inline">
										<input type="radio" id="opt3" name="iCheck"> Fecha
									</label>
									<label class="radio-inline">
										<input type="radio" id="opt4" name="iCheck"> Grupo
									</label>
								</div>

								<div id="busBauSm" class="btn-group btnsPubs" role="group">
									<button class="btn btn-default">No Bautizados</button>
									<button class="btn btn-default">Bautizados</button>
									<button id="mayor1Sm" class="btn btn-default">Mayor de 1 año</button>
								</div>

								<div id="mayor2Sm" class="btn-group hide" role="group">
									<button class="btn btn-default">Mas de 1 año</button>
								</div>

								<div class="clearfix"></div>

								<div class="btn-group btnsPubs" role="group">
									<button class="btn btn-default">Menores de 18</button>
									<button class="btn btn-default">Mayores de 18</button>
								</div>

								<div class="clearfix"></div>

								<span class="" style="color:darkcyan;font-size:14px;">Buscar por Estado:</span>
								<div class="btn-group btnsPubs" role="group">
									<button class="btn" style="background-color:#09B20F;width:40px;height:20px;"></button>
									<button class="btn" style="background-color:#ffad33;width:40px;height:20px;"></button>
									<button class="btn" style="background-color:#b30000;width:40px;height:20px;"></button>
									<button class="btn" style="background-color:#009999;width:40px;height:20px;"></button>
									<button class="btn" style="background-color:#b6b6b6;width:40px;height:20px;"></button>
								</div>

								<button id="clear" class="btn btn-success">Limpiar</button>
							</div>
							<div class="col-sm-6">
								<div class="blockPicker">
									<div class="form-group materialPicker">
										<div class="pickerPubs"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div id="pubs" class="col-md-12 col-lg-8">
					<div class="content-panel">
						<h3 class="text-center tableTitle">Informacion de los publicadores</h3>
						<section id="no-more-tables">
							<table id="public" class="table table-bordered table-striped table-condensed cf">
								<thead class="cf">
									<tr>
										<th class="text-center tConPubCol1">Nombre y Apellido</th>
										<th class="numeric text-center tConPubCol2">Edad</th>
										<th class="text-center tConPubCol3">Fecha de Bautismo</th>
										<th class="text-center tConPubCol4">Grupo Asignado</th>
										<th class="text-center tConPubCol5">Estado</th>
									</tr>
								</thead>
								<tbody>
								{% for x in pub %}
									<tr>
										<td class="text-center nombre tConPubCol1" data-title="Nombre:">
											<a href="{% url 'secretario:traerPub' x.id %}">{{ x.nombre }} {{ x.apellido }}</a>
										</td>
										<td class="text-center numeric tConPubCol2" data-title="Edad:">
											{{ x.edad }}
										</td>
										<td class="text-center bau tConPubCol3" data-title="Fecha de Bautismo:">
											{{ x.fechaBau }}
										</td>

										{% if not x.FKgrupo == 0 %}
											<td class="text-center tConPubCol4" data-title="Grupo:">
													<a href="{% url 'secretario:conGrupoofPubs' x.FKgrupo.IDgrupo %}">{{ x.FKgrupo }}</a>
											</td>
										{% else %}
											<td class="text-center tConPubCol4" data-title="Grupo:">
												Sin Grupo
											</td>
										{% endif %}

										{% if x.status == 0 %}
											<td class="estado tConPubCol5" id="{{x.id}}" data-title="Estado" style="background-color: #09B20F;" >

												<div style="display: none">
													<dl>
														<dt>Estado:</dt>
														<dd id="dgEstado">Activo</dd>

														<dt>Fecha del Ultimo Informe:</dt>
														<dd id="dgFecha">{{ x.fecha }}</dd>

														<dt>Intervalo:</dt>
														<dd id="dgInt">{{ x.intervalo }}</dd>

														<dt>Conclusiones:</dt>
														<dd id="dgConclu">El Publicador se encuentra en buen estado. Encomielo por su fiel labor</dd>
													</dl>
												</div>
											</td>
										{% elif x.status == 1 %}
											<td class="estado tConPubCol5" id="{{x.id}}" data-title="Estado" style="background-color:#ffad33">

												<div style="display: none">
													<dl>
														<dt>Estado:</dt>
														<dd id="dgEstado">Irregular</dd>

														<dt>Fecha del Ultimo Informe:</dt>
														<dd id="dgFecha">{{ x.fecha }}</dd>

														<dt>Intervalo:</dt>
														<dd id="dgInt">{{ x.intervalo }}</dd>

														<dt>Conclusiones:</dt>
														<dd id="dgConclu">El Publicador tiene {{ x.intervalo }} mes(es) sin informar. Se recomienda realizar un seguimiento con el fin de impartirle animo</dd>
													</dl>
												</div>
											</td>
										{% elif x.status ==  2 %}
											<td class="estado tConPubCol5" id="{{x.id}}" data-title="Estado" style="background-color:#b30000">

												<div style="display: none">
													<dl>
														<dt>Estado:</dt>
														<dd id="dgEstado">Inactivo</dd>

														<dt>Fecha del Ultimo Informe:</dt>
														<dd id="dgFecha">{{ x.fecha }}</dd>

														<dt>Intervalo:</dt>
														<dd id="dgInt">{{ x.intervalo }}</dd>

														<dt>Conclusiones:</dt>
														<dd id="dgConclu">El Publicador tiene mas de 6 meses sin informar, su estado es critico. Se recomienda realizar una Visita de Pastoreo</dd>
													</dl>
												</div>
											</td>
										{% elif x.status ==  3 %}
											<td class="estado tConPubCol5" id="{{x.id}}" data-title="Estado" style="background-color: #009999">

												<div style="display: none">
													<dl>
														<dt>Estado:</dt>
														<dd id="dgEstado">Nuevo</dd>

														<dt>Intervalo:</dt>
														<dd id="dgInt">{{ x.intervalo }}</dd>

														<dt>Conclusiones:</dt>
														<dd id="dgConclu">El Publicador esta recien nombrado ¡Que alegria contar con mas obreros para la ciega!</dd>
													</dl>
												</div>
											</td>
										{% else %}
											<td class="estado tConPubCol5" id="{{x.id}}" data-title="Estado" style="background-color: #b6b6b6">
												<div style="display: none">
													<dl>
														<dt>Estado:</dt>
														<dd id="dgEstado">Activo</dd>

														<dt>Fecha del Ultimo Informe:</dt>
														<dd id="dgFecha">{{ x.fecha }}</dd>

														<dt>Intervalo:</dt>
														<dd id="dgInt">{{ x.intervalo }}</dd>

														<dt>Conclusiones:</dt>
														<dd id="dgConclu">El Publicador no alcanzó el Promedio de Horas de los publicadores en el mes, Si esto continua se recomienda Seguimiento</dd>
													</dl>
												</div>
											</td>
										{% endif %}
									</tr>
								{% endfor %}
								</tbody>
							</table>
						</section>
					</div>
				</div>
			</div>
        </div>
	</div>
</div>

<div id="dialogo" style="display: none"></div>

{% endblock %}

{% block scripts %}
	<script>
		var check1
		var check2
		var vw

		$(document).ready(function(){

			$('input').iCheck({
				radioClass: 'iradio_flat-green'
			});

			check1 = $('div.visible-lg input[type="radio"]:eq(3)').parent().parent()
			check2 = $('div.visible-sm input[type="radio"]:eq(3)').parent().parent()

			vw = $(window).width()

			if(vw >= 1200 && vw < 1300){
				check1.removeClass('radio-inline')
				check1.css('margin-top', '5px')
			}

			if(vw >= 1200 && vw < 1440){
				$('#mayor1').detach()
				$('#mayor2').removeClass('hide')
			}


			if(vw > 768 && vw < 960){
				if(vw <= 900){
					check2.removeClass('radio-inline')
					check2.css('margin-top', '5px')
				}

				$('#mayor1Sm').detach()
				$('#mayor2Sm').removeClass('hide')
			}
		})

		$('div.fa-bars').click(function(){

			if((vw >768 && vw <= 904) && $('#container').attr('class') != 'sidebar-closed' ){
				check2.removeClass('radio-inline')
				check2.css('margin-top', '5px')
			} else {
				check2.addClass('radio-inline')
				check2.css('margin-top', '0px')
			}

			if((vw >768 && vw < 960) && $('#container').attr('class') != 'sidebar-closed' ){
				$('#mayor1Sm').detach()
				$('#mayor2Sm').removeClass('hide')

			} else if ((vw >= 960 && vw <= 991) || $('#container').attr('class') == 'sidebar-closed'){
				if( $('#busBauSm').children().length == 2 ){
					$('#busBauSm').append('<button id="mayor1Sm" class="btn btn-default">Mayor de 1 año</button>')
					$('#mayor2Sm').addClass('hide')
				}
			}

		})

		$(window).resize(function(){

			vw = $(this).width()

			//responsive of the panel: options
			if( vw >= 1200 && vw < 1300){
				check1.removeClass('radio-inline')
				check1.css('margin-top', '5px')
			} else if(vw >= 1300){
				check1.addClass('radio-inline')
				check1.css('margin-top', '0px')
			}

			if((vw >768 && vw <= 904) && $('#container').attr('class') != 'sidebar-closed'){
				check2.removeClass('radio-inline')
				check2.css('margin-top', '5px')
			} else if((vw > 904 && vw <= 991) || $('#container').attr('class') == 'sidebar-closed'){
				check2.addClass('radio-inline')
				check2.css('margin-top', '0px')
			}

			//responsive of the panel: buttons filters
			if(vw >= 1200 && vw < 1440){
				$('#mayor1').detach()
				$('#mayor2').removeClass('hide')
			} else if((vw < 991 || vw >= 1440) && $('#busBau').children().length == 2 ){
				$('#busBau').append('<button id="mayor1" class="btn btn-default">Mayor de 1 año</button>')
				$('#mayor1').click(function(){ searchHigherOneYear() })
				$('#mayor2').addClass('hide')
			}

			if((vw >768 && vw < 960) && $('#container').attr('class') != 'sidebar-closed' ){
				$('#mayor1Sm').detach()
				$('#mayor2Sm').removeClass('hide')

			} else if ((vw >= 960 && vw <= 991) || $('#container').attr('class') == 'sidebar-closed'){
				if( $('#busBauSm').children().length == 2 ){
					$('#busBauSm').append('<button id="mayor1Sm" class="btn btn-default">Mayor de 1 año</button>')
					$('#mayor1Sm').click(function(){ searchHigherOneYear() })
					$('#mayor2Sm').addClass('hide')
				}
			}
		})

		//dateTable
			var table = $('#public').DataTable({
				"bPaginate":true,
				"bInfo":false,
				"bFilter":true,
				"oLanguage": {
						      "sInfoEmpty": "La Tabla esta Vacia",
						      "sZeroRecords": "No se Encontraron Registros"
						     }
				});

			//estilisando los filtros por defecto
			$('#public_length').hide()
			$('#public_filter').hide()
			//$('#public_paginate').hide()
	        $('.filtro').on( 'keyup change', function (){
				$('#public').dataTable().fnFilter( this.value )
			})
        //end dateTable

		//dataTimePicker
			$(function () {
	            $('.pickerPubs').datetimepicker({
	                inline: true,
	                showTodayButton:true,
	                viewMode: 'days',
	                format: 'YYYY-MM-DD',
		            widgetPositioning: {
			            horizontal: 'right',
			            vertical: 'auto'
			        }
	            }).on("dp.change", function(e) {
						date = $('.pickerPubs').data("DateTimePicker").viewDate()
						date = moment(date._d.toJSON()).format('YYYY-MM-DD')
	            		$('.filtro').val(date)
	            		$('.filtro').change()
	        		});
	        });
		//end dataTimePicker

		//button clear filter
				btnClear = $(".visible-lg #clear, .visible-md #clear, .visible-sm #clear")
				btnClear.click(function(){
				fechai = fechaf = fechaActual = look = ""
				$('.filtro').val("").change()
				table.columns().search('').draw()
			})
		//end button clear

		//icheck
			var column
			$('input').on('ifChecked', function(){
				opt = ""
				column = ""

				opt = parseInt( $(this).eq(0).attr('id').substr(-1) )

				if(opt == 1){
					column = table.column(0)
				}

				if(opt == 2){
					column = table.column(1)
				}

				if(opt == 3){
					column = table.column(2)
				}

				if(opt == 4){
					column = table.column(3)
				}
			})

			$('.filtro').on( 'keyup change', function(){
				if( column && column.search() !== this.value ){
					column
						.search( this.value )
						.draw();
				}
			})
		//end icheck

		//panel
			panels = $('.visible-lg .btn-group, .visible-md .btn-group, .visible-sm .btn-group')

			//first group
				//search for 'no bautazados'
				$( '.visible-lg .btn-group:eq(0) > button:eq(0), \
					.visible-md .btn-group:eq(0) > button:eq(0), \
					.visible-sm .btn-group:eq(0) > button:eq(0)' )
				.click(function(){
					btnClear.click()
					table.column(2).search( 'No Bautizado' ).draw()
				})

				//search for 'bautizados'
				$( '.visible-lg .btn-group:eq(0) > button:eq(1), \
					.visible-md .btn-group:eq(0) > button:eq(1), \
					.visible-sm .btn-group:eq(0) > button:eq(1)' )
				.click(function(){
					btnClear.click()
					fechai = '1900'
					fechaf = moment( new Date() ).format('YYYY')
					table.draw()
				})

				//search for 'mayores de 1 año'
				function searchHigherOneYear(){
					btnClear.click()
					fechaActual = moment( new Date() ).format('YYYY-MM-DD')
					fechaActual = moment(fechaActual)
					table.draw()
				}

				$( '#mayor2 button, \
					#mayor2Sm button' )
				.click(function(){ searchHigherOneYear() })

				$( '.visible-lg .btn-group:eq(0) > button:eq(2), \
					.visible-md .btn-group:eq(0) > button:eq(2), \
					.visible-sm .btn-group:eq(0) > button:eq(2)' )
				.click(function(){ searchHigherOneYear() })
			//end first group

			//second group
				//search for 'Menores de 18'
				$( '.visible-lg .btn-group:eq(2) > button:eq(0), \
					.visible-md .btn-group:eq(1) > button:eq(0), \
					.visible-sm .btn-group:eq(2) > button:eq(0)' )
				.click(function(){
					btnClear.click()
					look = 1
					table.draw()
				})

				//search for 'Mayores de 18'
				$( '.visible-lg .btn-group:eq(2) > button:eq(1), \
					.visible-md .btn-group:eq(1) > button:eq(1), \
					.visible-sm .btn-group:eq(2) > button:eq(1)' )
				.click(function(){
					btnClear.click()
					look = 2
					table.draw()
				})
			//end second group

			//third group
				table.rowColor()

				$( '.visible-lg .btn-group:eq(3) > button:eq(0), \
					.visible-md .btn-group:eq(2) > button:eq(0), \
					.visible-sm .btn-group:eq(3) > button:eq(0)' )
				.click(function(){
					btnClear.click()
					table.searchColor('#09B20F')//green
				})
				$( '.visible-lg .btn-group:eq(3) > button:eq(1), \
					.visible-md .btn-group:eq(2) > button:eq(1), \
					.visible-sm .btn-group:eq(3) > button:eq(1)' )
				.click(function(){
					btnClear.click()
					table.searchColor('#FFAD33')//orange
				})
				$( '.visible-lg .btn-group:eq(3) > button:eq(2), \
					.visible-md .btn-group:eq(2) > button:eq(2), \
					.visible-sm .btn-group:eq(3) > button:eq(2)' )
				.click(function(){
					btnClear.click()
					table.searchColor('#B30000')//red
				})
				$( '.visible-lg .btn-group:eq(3) > button:eq(3), \
					.visible-md .btn-group:eq(2) > button:eq(3), \
					.visible-sm .btn-group:eq(3) > button:eq(3)' )
				.click(function(){
					btnClear.click()
					table.searchColor('#009999')//turquoise
				})
				$( '.visible-lg .btn-group:eq(3) > button:eq(4), \
					.visible-md .btn-group:eq(2) > button:eq(4), \
					.visible-sm .btn-group:eq(3) > button:eq(4)' )
				.click(function(){
					btnClear.click()
					table.searchColor('#B6B6B6')//gray
				})
			//end third group
		//end panel

		//dialog
			$('td.estado').mouseover(function(){
				$('#dialogo').html(
					$(this).find('div').html()
				)

				$('#dialogo').dialog({
					title: "Detalles del Estado",
					position: { my: "right-60 center", at: "", of: this },
					dialogClass: 'dlg-no-title',
				});
			})
			$('td.estado').mouseleave(function(){
				$('#dialogo').dialog("destroy")
			})
		//end dialog

		//alert when edit public
            {% if msg %}
                $.gritter.add({
					title: 'Modificar publicador',
					text: "{{ msg }}",
					image: '',
					sticky: false,
					time: 3000,
					class_name: ''
				});
            {% endif %}
		//end alert
	</script>
{% endblock %}
